{% extends "layout.html" %}

{% block content %}
<div class="card p-4 shadow">
    <h1>Step 1: Model Configuration</h1>
    <form action="{{ url_for('step1') }}" method="POST" enctype="multipart/form-data">
        <!-- Input 1: Target Board Dropdown -->
        <div class="form-group">
            <label for="target_board">Please choose your target board:</label>
            <select name="target_board" id="target_board" class="form-control" onchange="resetOptions(); showOptions()">
                <option value="other" selected>Other</option>  <!-- Set 'Other' as default -->
                <option value="pynq_z2">Pynq Z2</option>
                <option value="pynq_zu">Pynq ZU</option>
            </select>
        </div>

        <!-- Input 2: Pre-trained or Untrained Model -->
        <div id="modelOptions" class="form-group" style="display: none;">
            <label for="model_type">Are you inputting a pre-trained model or untrained model?</label><br>
            <input type="radio" name="model_type" value="pretrained" onclick="resetModelOptions(); showModelOptions()"> Pre-trained Model<br>
            <input type="radio" name="model_type" value="untrained" onclick="resetModelOptions(); showModelOptions()"> Untrained Model
        </div>

        <!-- Input 3: Verify Accuracy -->
        <div id="verifyOptions" class="form-group" style="display: none;">
            <label for="verify_accuracy">Do you want to verify your pre and post accuracy?</label><br>
            <input type="radio" name="verify_accuracy" value="yes" onclick="showModelOptions()"> Yes<br>
            <input type="radio" name="verify_accuracy" value="no" onclick="showModelOptions()"> No
        </div>

        <!-- Input 4: Upload pth file for pre-trained model -->
        <div id="pretrainedOptions" class="form-group" style="display: none;">
            <label for="pth_file">Upload your pth file (only accepts pth files):</label>
            <input type="file" name="pth_file" accept=".pth" class="form-control">
        </div>

        <!-- Input 5: Upload model.py -->
        <div id="modelUploadOptions" class="form-group" style="display: none;">
            <label for="model_file">Upload your model.py:</label>
            <input type="file" name="model_file" accept=".py" class="form-control">
        </div>

        <!-- Input 6: Choose Dataset -->
        <div id="datasetOptions" class="form-group" style="display: none;">
            <label for="dataset">Choose a dataset:</label>
            <select name="dataset" class="form-control">
                <option value="cifar10">Cifar 10</option>
                <option value="mnist">MNIST</option>
                <option value="other">Other</option>
            </select>
            <small id="datasetNote" class="form-text text-muted" style="display: none;">Choose the dataset the model was initially trained on.</small>
        </div>

        <button type="submit" class="btn btn-primary">Next</button>
    </form>
</div>

<script>
    // Reset all options to be hidden
    function resetOptions() {
        document.getElementById('modelOptions').style.display = 'none';
        document.getElementById('pretrainedOptions').style.display = 'none';
        document.getElementById('modelUploadOptions').style.display = 'none';
        document.getElementById('datasetOptions').style.display = 'none';
        document.getElementById('datasetNote').style.display = 'none';
        document.getElementById('verifyOptions').style.display = 'none';
    }

    // Show options based on selected target board
    function showOptions() {
        var board = document.getElementById('target_board').value;
        if (board === 'other') {
            alert('We do not support other boards at the moment.');
        } else {
            document.getElementById('modelOptions').style.display = 'block';
            document.getElementById('verifyOptions').style.display = 'block';
        }
    }

    // Reset model-related options when model type is changed
    function resetModelOptions() {
        document.getElementById('pretrainedOptions').style.display = 'none';
        document.getElementById('modelUploadOptions').style.display = 'none';
        document.getElementById('datasetOptions').style.display = 'none';
        document.getElementById('datasetNote').style.display = 'none';
    }

    // Show model options and dataset options based on pre-trained/untrained model and verification
    function showModelOptions() {
        var modelType = document.querySelector('input[name="model_type"]:checked').value;
        var verifyAccuracy = document.querySelector('input[name="verify_accuracy"]:checked');

        if (modelType === 'pretrained') {
            document.getElementById('pretrainedOptions').style.display = 'block';
            if ((verifyAccuracy && verifyAccuracy.value === 'yes')) {
                document.getElementById('datasetOptions').style.display = 'block';
                document.getElementById('datasetNote').style.display = 'block';
            } else {
                document.getElementById('datasetOptions').style.display = 'none';
                document.getElementById('datasetNote').style.display = 'none';
            }
        }

        if (modelType === 'untrained') {
            document.getElementById('modelUploadOptions').style.display = 'block';
            document.getElementById('datasetOptions').style.display = 'block';
        }
    }
</script>
{% endblock %}
